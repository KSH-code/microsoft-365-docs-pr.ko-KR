---
title: 고급 감사를 사용하여 손상된 계정 조사
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: MailItemsAccessed 사서함 감사 작업을 사용하여 손상된 사용자 계정에 대한 포렌식 조사를 수행합니다.
ms.openlocfilehash: 20c57f1d11af8fded15cc2fdf280414f7172ffd7
ms.sourcegitcommit: 22e9f54d0d3ead2be91a38d49325308c70f43f90
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/15/2020
ms.locfileid: "44262581"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a><span data-ttu-id="730f3-103">고급 감사를 사용하여 손상된 계정 조사</span><span class="sxs-lookup"><span data-stu-id="730f3-103">Use Advanced Audit to investigate compromised accounts</span></span>

<span data-ttu-id="730f3-104">손상된 사용자 계정은(*계정 인수*라고도 함) 공격자가 사용자 계정의 액세스 권한을 얻어 사용자로 작업할 때의 공격 유형입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-104">A compromised user account (also called an *account takeover*) is a type of attack when an attacker gains access to a user account and operates as the user.</span></span> <span data-ttu-id="730f3-105">가끔 이러한 유형의 공격은 공격자가 의도한 것 보다 더 많은 손상을 야기할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-105">These types of attacks sometimes cause more damage than the attacker may have intended.</span></span> <span data-ttu-id="730f3-106">손상된 전자 메일 계정을 조사할 때 공격자의 실제 현재 상태를 추적하여 표시될 수 있는 것 보다 더 많은 전자 메일 데이터가 손상되었다고 가정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-106">When investigating compromised email accounts, you have to assume that more mail data was compromised than may be indicated by tracing the attacker's actual presence.</span></span> <span data-ttu-id="730f3-107">전자 메일 메시지의 데이터 형식에 따라 중요 한 정보가 손상되었다고 가정하거나 중요한 정보가 노출되지 않은 것을 증명할 수 없는 경우 규제적 벌금을 내야합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-107">Depending on the type of data in email messages, you have to assume that sensitive information was compromised or face regulatory fines unless you can prove that sensitive information wasn't exposed.</span></span> <span data-ttu-id="730f3-108">예를 들어, HIPAA 규제 조직은 환자의 건강 정보(PHI)가 노출되었다는 증거가 있는 경우 상당한 벌금을 내야합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-108">For example, HIPAA-regulated organizations face significant fines if there is evidence that patient health information (PHI) was exposed.</span></span> <span data-ttu-id="730f3-109">이 경우 공격자는 PHI에 관심을 가질 가능성이 적습니다. 그러나 조직은 달리 증명할 수 없는 경우 여전히 데이터 침해를 보고해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-109">In these cases, attackers are unlikely to be interested in PHI, but organizations still must report data breaches unless they can prove otherwise.</span></span>

<span data-ttu-id="730f3-110">손상된 전자 메일 계정을 조사하는 데 도움을 주기 위해 당사는 이제 메일 프로토콜 및 클라이언트로 *MailItemsAccessed* 사서함 감사 작업으로 액세스를 감사하고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-110">To help you with investigating compromise email accounts, we're now auditing accesses of mail data by mail protocols and clients with the *MailItemsAccessed* mailbox auditing action.</span></span> <span data-ttu-id="730f3-111">새로 감사된 이 작업은 조사자들이 전자 메일의 데이터 침해에 대해 더욱 잘 이해하도록 도움을 주고 손상될 수 있는 특정 메일 항목에 대한 손상 범위를 식별하는 데 도움이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-111">This new audited action will help investigators better understand email data breaches and help you identify the scope of compromises to specific mail items that may been compromised.</span></span> <span data-ttu-id="730f3-112">이 새 감사 작업을 사용하는 목적은 특정 메일 데이터가 손상되지 않았음을 주장하는데 도움을 주는 포렌식 방어 능력입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-112">The goal of using this new auditing action is forensics defensibility to help assert that a specific piece of mail data was not compromised.</span></span> <span data-ttu-id="730f3-113">공격자가 메일의 특정 부분에 대한 액세스 권한을 얻게 되면 메일 항목을 실제로 읽은 것으로 표시되지 않은 경우에도 Exchange Online에서 해당 이벤트를 감사합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-113">If an attacker gained access to a specific piece of mail, Exchange Online audits the event even though there is no indication that the mail item was actually read.</span></span>

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a><span data-ttu-id="730f3-114">MailItemsAccessed 사서함 감사 작업</span><span class="sxs-lookup"><span data-stu-id="730f3-114">The MailItemsAccessed mailbox auditing action</span></span>

<span data-ttu-id="730f3-115">새 MailItemsAccessed 작업은 새로운 [고급 감사](advanced-audit.md) 기능의 일부입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-115">The new MailItemsAccessed action is part of the new [Advanced Audit](advanced-audit.md) functionality.</span></span> <span data-ttu-id="730f3-116">[Exchange 사서함 감사](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions)의 일부이며, Office 365 혹은 Microsoft 365 E5 라이선스가 부여된 사용자나 Microsoft 365 E5 준수 추가 기능 구독이 있는 조직에 기본적으로 활성화되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-116">It's part of [Exchange mailbox auditing](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) and is enabled by default for users that are assigned an Office 365 or Microsoft 365 E5 license or for organizations with a Microsoft 365 E5 Compliance add-on subscription.</span></span>

<span data-ttu-id="730f3-117">MailItemsAccessed 사서함 감사 작업은 POP, IMAP, MAPI, EWS, Exchange ActiveSync 및 REST와 같은 모든 메일 프로토콜을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-117">The MailItemsAccessed mailbox auditing action covers all mail protocols: POP, IMAP, MAPI, EWS, Exchange ActiveSync, and REST.</span></span> <span data-ttu-id="730f3-118">또한 *동기화* 및 *바인딩*에 대한 두 가지 메일 액세스 유형을 다룹니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-118">It also covers both types of accessing mail: *sync* and *bind*.</span></span>

### <a name="auditing-sync-access"></a><span data-ttu-id="730f3-119">동기화 액세스 감사</span><span class="sxs-lookup"><span data-stu-id="730f3-119">Auditing sync access</span></span>

<span data-ttu-id="730f3-120">Windows 또는 Mac용 Outlook 클라이언트의 데스크톱 버전에서 사서함에 액세스하는 경우에만 동기화 작업이 기록됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-120">Sync operations are only recorded when a mailbox is accessed by a desktop version of the Outlook client for Windows or Mac.</span></span> <span data-ttu-id="730f3-121">동기화 작업 중에 일반적으로 이러한 클라이언트는 클라우드에서 많은 메일 항목의 집합을 로컬 컴퓨터로 다운로드합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-121">During the sync operation, these clients typically download a large set of mail items from the cloud to a local computer.</span></span> <span data-ttu-id="730f3-122">동기화 작업에 대한 감사 볼륨은 매우 큽니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-122">The audit volume for sync operations is huge.</span></span> <span data-ttu-id="730f3-123">따라서 동기화되는 각 메일 항목에 대한 감사 레코드를 생성하는 대신, 동기화된 항목이 포함된 메일 폴더에 대한 감사 이벤트를 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-123">So, instead of generating an audit record for each mail item that's synched, we just generate an audit event for the mail folder containing items that were synched.</span></span> <span data-ttu-id="730f3-124">이는 동기화된 폴더의 *모든* 메일 항목이 손상되었다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-124">This makes the assumption that *all* mail items in the synched folder have been compromised.</span></span> <span data-ttu-id="730f3-125">액세스 형식은 감사 레코드의 OperationsProperties 필드에 기록됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-125">The access type is recorded in the OperationsProperties field of the audit record.</span></span> 

<span data-ttu-id="730f3-126">감사 레코드에 동기화 액세스 유형을 표시하는 예제는 [포렌식 조사를 위해 MailItemsAccessed 감사 레코드를 사용](#use-mailitemsaccessed-audit-records-for-forensic-investigations) 섹션의 2단계를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-126">See step 2 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the sync access type in an audit record.</span></span>

### <a name="auditing-bind-access"></a><span data-ttu-id="730f3-127">바인딩 액세스 감사</span><span class="sxs-lookup"><span data-stu-id="730f3-127">Auditing bind access</span></span>

<span data-ttu-id="730f3-128">바인딩 작업은 전자 메일 메시지에 대한 개별 액세스입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-128">A bind operation is an individual access to an email message.</span></span> <span data-ttu-id="730f3-129">바인딩 액세스의 경우 개별 메시지의 인터넷 메시지 ID가 감사 레코드에 기록됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-129">For bind access, the internet-message-id of individual messages will be recorded in the audit record.</span></span> <span data-ttu-id="730f3-130">MailItemsAccessed 감사 작업은 바인딩 작업을 레코드한 다음 하나의 감사 레코드로 집계합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-130">The MailItemsAccessed audit action records bind operations and then aggregates into a single audit record.</span></span> <span data-ttu-id="730f3-131">2분 간격 이내에 발생하는 모든 바인딩 작업은 AuditData 속성 내에 있는 폴더 필드의 단일 감사 레코드에 집계됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-131">All bind operations that occur within a 2-minute interval are aggregated in a single audit record in the Folders field within the AuditData property.</span></span> <span data-ttu-id="730f3-132">액세스한 각 메시지는 인터넷 메시지 ID로 식별 됩니다. 레코드에 집계된 바인딩 작업 수가 AuditData 속성의 OperationCount 필드에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-132">Each message that was accessed is identified by its internet-message-id. The number of bind operations that were aggregated in the record is displayed in the OperationCount field in the AuditData property.</span></span>

<span data-ttu-id="730f3-133">감사 레코드에 바인딩 액세스 유형을 표시하는 예제는 [포렌식 조사를 위해 MailItemsAccessed 감사 레코드를 사용](#use-mailitemsaccessed-audit-records-for-forensic-investigations) 섹션의 4단계를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-133">See step 4 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the bind access type in an audit record.</span></span>

### <a name="throttling-of-mailitemsaccessed-audit-records"></a><span data-ttu-id="730f3-134">MailItemsAccessed 감사 레코드 제한</span><span class="sxs-lookup"><span data-stu-id="730f3-134">Throttling of MailItemsAccessed audit records</span></span>

<span data-ttu-id="730f3-135">24시간 이내에 1,000개 이상의 MailItemsAccessed 감사 레코드가 생성되는 경우, Exchange Online에서 MailItemsAccessed 활동에 대한 감사 레코드 생성을 중단합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-135">If more than 1,000 MailItemsAccessed audit records are generated in less than 24 hours, Exchange Online will stop generating auditing records for MailItemsAccessed activity.</span></span> <span data-ttu-id="730f3-136">사서함이 제한되면 사서함이 제한된 후 24시간 동안 MailItemsAccessed 활동이 기록되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-136">When a mailbox is throttled, MailItemsAccessed activity will not be logged for 24 hours after the mailbox was throttled.</span></span> <span data-ttu-id="730f3-137">이 경우 해당 기간에 사서함이 손상될 가능성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-137">If this occurs, there's a potential that mailbox could have been compromised during this period.</span></span> <span data-ttu-id="730f3-138">MailItemsAccessed의 활동의 기록은 24시간 후에 다시 시작됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-138">The recording of MailItemsAccessed activity will be resumed following a 24-hour period.</span></span>  

<span data-ttu-id="730f3-139">제한과 관련하여 유의해야 할 몇 가지 사항은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-139">Here's a few things to keep in mind about throttling:</span></span>

- <span data-ttu-id="730f3-140">Exchange Online의 모든 사서함의 1% 미만이 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-140">Less than 1% of all mailboxes in Exchange Online are throttled</span></span>

- <span data-ttu-id="730f3-141">사서함이 제한되면 MailItemsAccessed 활동에 대한 감사 레코드만 감사되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-141">When a mailbox is throttling, only audit records for MailItemsAccessed activity are not audited.</span></span> <span data-ttu-id="730f3-142">다른 사서함 감사 작업은 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-142">Other mailbox auditing actions aren't affected.</span></span>

- <span data-ttu-id="730f3-143">사서함은 바인딩 작업에만 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-143">Mailboxes are throttled only for Bind operations.</span></span> <span data-ttu-id="730f3-144">동기화 작업에 대한 감사 레코드는 제한되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-144">Audit records for sync operations are not throttled.</span></span>

- <span data-ttu-id="730f3-145">사서함이 제한된 경우에는 감사 로그에 기록되지 않은 MailItemsAccessed 활동이 있었다고 가정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-145">If a mailbox is throttled, you can probably assume there was MailItemsAccessed activity that wasn't recorded in the audit logs.</span></span>

<span data-ttu-id="730f3-146">감사 레코드에 IsThrottled 속성을 표시하는 예제는 [포렌식 조사를 위해 MailItemsAccessed 감사 레코드를 사용](#use-mailitemsaccessed-audit-records-for-forensic-investigations) 섹션의 1단계를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-146">See step 1 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the IsThrottled property in an audit record.</span></span>

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a><span data-ttu-id="730f3-147">포렌식 조사를 위해 MailItemsAccessed 감사 레코드 사용</span><span class="sxs-lookup"><span data-stu-id="730f3-147">Use MailItemsAccessed audit records for forensic investigations</span></span>

<span data-ttu-id="730f3-148">사서함 감사는 전자 메일 메시지로의 액세스에 대한 감사 레코드를 생성하여 전자 메일 메시지가 손상되지 않았음을 확신할 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-148">Mailbox auditing generates audit records for access to email messages so that you can be confident that email messages haven't been compromised.</span></span> <span data-ttu-id="730f3-149">이러한 이유로 일부 데이터에 액세스했는지 확실하지 않은 경우 모든 메일 액세스 활동을 기록하여 액세스한 것으로 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-149">For this reason, in circumstances where we're not certain that some data has been accessed, we assume that it has by recording all mail access activity.</span></span>

<span data-ttu-id="730f3-150">포렌식 목적의 MailItemsAccessed 감사 레코드 사용은 일반적으로 데이터 침해가 해결되고 공격자가 제거된 후에 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-150">Using MailItemsAccessed audit records for forensics purposes is typically performed after a data breach has been resolved and the attacker has been evicted.</span></span> <span data-ttu-id="730f3-151">조사를 시작하려면 손상된 사서함 집합을 확인 하고, 공격자가 조직의 사서함에 액세스할 때의 시간 프레임을 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-151">To begin your investigation, you should identify the set of mailboxes that they have been compromised and determine the time frame when attacker had access to mailboxes in your organization.</span></span> <span data-ttu-id="730f3-152">그런 다음 [Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell)에서 **Search-UnifiedAuditLog** 혹은 **Search-MailboxAuditLog** cmdlet을 사용하여 데이터 위반에 해당하는 감사 레코드를 검색할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-152">Then, you can use the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets in [Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell) to search audit records that correspond to the data breach.</span></span> 

<span data-ttu-id="730f3-153">다음의 명령 중 하나를 실행하여 MailItemsAccessed 감사 레코드를 검색할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-153">You can run one of the following commands to search for MailItemsAccessed audit records:</span></span>

<span data-ttu-id="730f3-154">**통합 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-154">**Unified audit log**</span></span>

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

<span data-ttu-id="730f3-155">**사서함 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-155">**Mailbox audit log**</span></span>

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> <span data-ttu-id="730f3-156">이들 cmdlet의 기본 차이점은 **Search-UnifiedAuditLog** cmdlet를 사용하면 한 명 이상의 사용자가 수행한 활동에 대한 감사 레코드를 검색할 수 있다는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-156">One primary difference between these two cmdlets in that you can use the **Search-UnifiedAuditLog** cmdlet to search for audit records for activity performed by one or more users.</span></span> <span data-ttu-id="730f3-157">이는 *UserIds*가 다중 값 매개 변수이기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-157">That's because *UserIds* is a multi-value parameter.</span></span> <span data-ttu-id="730f3-158">**Search-MailboxAuditLog** cmdlet은 사서함 감사 로그에서 단일 사용자를 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-158">The **Search-MailboxAuditLog** cmdlet searches the mailbox audit log for a single user.</span></span>

<span data-ttu-id="730f3-159">다음은 MailItemsAccessed 감사 레코드를 사용 하여 손상된 사용자 공격을 조사하는 단계입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-159">Here are the steps for using MailItemsAccessed audit records to investigate a compromised user attack.</span></span> <span data-ttu-id="730f3-160">각 단계는 **Search-UnifiedAuditLog** 혹은 **Search-MailboxAuditLog** cmdlet에 대한 명령 구문을 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-160">Each step shows the command syntax for the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets.</span></span>

1. <span data-ttu-id="730f3-161">사서함이 제한되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-161">Check whether the mailbox has been throttled.</span></span> <span data-ttu-id="730f3-162">제한된 경우 일부 사서함 감사 레코드는 기록되지 않았을 수도 있음을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-162">If so, this would mean that some mailbox auditing records would not have been logged.</span></span> <span data-ttu-id="730f3-163">어떤 감사 레코드의 "IsThrottled"가 "True"인 경우 레코드가 생성된 후 24시간 동안 사서함으로의 모든 액세스가 감사되지 않았으며 모든 메일 데이터가 손상되었다고 가정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-163">In the case that any audit records have the "IsThrottled" is "True," you should assume that for a 24-hour period afterwards that record was generated, that any access to the mailbox was not audited and that all mail data has been compromised.</span></span>

   <span data-ttu-id="730f3-164">사서함이 제한된 위치에서 MailItemsAccessed를 검색하려면 다음의 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-164">To search for MailItemsAccessed records where the mailbox was throttled, run the following command:</span></span>

   <span data-ttu-id="730f3-165">**통합 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-165">**Unified audit log**</span></span>
 
   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   <span data-ttu-id="730f3-166">**사서함 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-166">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. <span data-ttu-id="730f3-167">동기화 활동을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-167">Check for sync activities.</span></span> <span data-ttu-id="730f3-168">공격자가 전자 메일 클라이언트를 사용하여 사서함에 메시지를 다운로드하면 컴퓨터의 인터넷 연결을 해제하고 서버와 상호 작용을 하지 않고도 로컬에서 메시지에 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-168">If an attacker uses an email client to downloaded messages in a mailbox, they can disconnect the computer from the Internet and access the messages locally without interacting with the server.</span></span> <span data-ttu-id="730f3-169">이는 사서함 감사가 이러한 활동을 감사할 수 없음을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-169">This means that mailbox auditing would not be able to audit these activities.</span></span>

   <span data-ttu-id="730f3-170">동기화 작업으로 메일 항목이 액세스된 위치에서 MailItemsAccessed를 검색하려면 다음의 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-170">To search for MailItemsAccessed records where the mail items were accessed by a sync operation, run the following command:</span></span>

   <span data-ttu-id="730f3-171">**통합 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-171">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   <span data-ttu-id="730f3-172">**사서함 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-172">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. <span data-ttu-id="730f3-173">동기화 활동을 확인하여 공격자가 사서함에 액세스하는 데 사용한 것과 동일한 컨텍스트로 발생한 활동이 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-173">Check sync activities to determine in any of them have occurred in the same context as the one used by the attacker access the mailbox.</span></span> <span data-ttu-id="730f3-174">컨텍스트는 사서함에 액세스하는 데 사용되는 클라이언트 컴퓨터의 IP 주소 및 메일 프로토콜로 식별하고 구분합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-174">Context is identified and differentiated by the IP address of the client computer used to access the mailbox and the mail protocol.</span></span> <span data-ttu-id="730f3-175">자세한 내용은 [다양한 감사 레코드의 액세스 컨텍스트 식별](#identifying-the-access-contexts-of-different-audit-records) 섹션을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-175">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="730f3-176">아래 나열된 속성을 사용하여 조사합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-176">Use the properties listed below to investigate.</span></span> <span data-ttu-id="730f3-177">이들 속성은 AuditData 또는 OperationProperties 속성에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-177">These properties are located in the AuditData or OperationProperties property.</span></span> <span data-ttu-id="730f3-178">동기화가 침입자 활동과 동일한 컨텍스트로 발생하는 경우 공격자가 모든 메일 항목을 클라이언트로 동기화했다고 가정합니다. 이는 아마도 전체 사서함이 손상되었을 수도 있음을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-178">If any of the syncs occur in the same context as the attacker activity, assume the attacker has synced all mail items to their client, which means the entire mailbox has probably been compromised.</span></span>

   |<span data-ttu-id="730f3-179">속성</span><span class="sxs-lookup"><span data-stu-id="730f3-179">Property</span></span>         | <span data-ttu-id="730f3-180">설명</span><span class="sxs-lookup"><span data-stu-id="730f3-180">Description</span></span> |
   |:---------------- | :----------|
   |<span data-ttu-id="730f3-181">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="730f3-181">ClientInfoString</span></span> | <span data-ttu-id="730f3-182">프로토콜, 클라이언트(버전 포함)에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-182">Describes protocol, client (includes version)</span></span>|
   |<span data-ttu-id="730f3-183">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="730f3-183">ClientIPAddress</span></span>  | <span data-ttu-id="730f3-184">클라이언트 컴퓨터의 IP 주소입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-184">IP address of the client machine.</span></span>|
   |<span data-ttu-id="730f3-185">SessionId</span><span class="sxs-lookup"><span data-stu-id="730f3-185">SessionId</span></span>        | <span data-ttu-id="730f3-186">세션 ID는 동일한 계정에서(손상된 계정의 경우) 공격자 작업과 일상적 사용자의 활동 구분하는 데 도움이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-186">Session ID helps to differentiate attacker actions vs day-to-day user activities on the same account (in the case of a compromised account)</span></span>|
   |<span data-ttu-id="730f3-187">UserId</span><span class="sxs-lookup"><span data-stu-id="730f3-187">UserId</span></span>           | <span data-ttu-id="730f3-188">메시지를 읽는 사용자의 UPN입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-188">UPN of the user reading the message.</span></span>|
   |||

4. <span data-ttu-id="730f3-189">바인딩 활동을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-189">Check for bind activities.</span></span> <span data-ttu-id="730f3-190">2단계와 3단계를 수행한 후에는 공격자의 모든다른 전자 메일 메시지로의 액세스가 "바인딩” 값이 있는 MailAccessType 속성을 갖는 MailItemsAccessed 감사 레코드로 캡처될 것임을 확신할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-190">After performing steps 2 and step 3, you can be confident that all other access to email messages by the attacker will be captured in the MailItemsAccessed audit records that have a MailAccessType property with a value of "Bind".</span></span>

   <span data-ttu-id="730f3-191">메일 항목이 바인딩 작업으로 액세스된 MailItemsAccessed 레코드를 검색하려면 다음의 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-191">To search for MailItemsAccessed records where the mail items were accessed by a Bind operation, run the following command.</span></span>

   <span data-ttu-id="730f3-192">**통합 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-192">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```
 
   <span data-ttu-id="730f3-193">**사서함 감사 로그**</span><span class="sxs-lookup"><span data-stu-id="730f3-193">**Mailbox audit log**</span></span>
   
   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   <span data-ttu-id="730f3-194">액세스한 전자 메일 메시지는 인터넷 메시지 ID로 식별됩니다. 감사 레코드 중 다른 침입자 활동에 대한 감사 레코드와 동일한 컨텍스트를 포함하는 감사 레코드가 있는지를 확인할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-194">Email messages that were accessed are identified by their internet message Id. You can also check to see if any audit records have the same context as the ones for other attacker activity.</span></span> <span data-ttu-id="730f3-195">자세한 내용은 [다양한 감사 레코드의 액세스 컨텍스트 식별](#identifying-the-access-contexts-of-different-audit-records) 섹션을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-195">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>
 
   <span data-ttu-id="730f3-196">다음과 같은 두 가지 방법으로 바인딩 작업에 감사 데이터를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-196">You can use the audit data for bind operations in two different ways:</span></span>

     - <span data-ttu-id="730f3-197">공격자가 인터넷 메시지 ID를 사용하여 액세스한 모든 전자 메일 메시지에 액세스를 하거나 수집을 하여 찾고 해당 메시지 가운데 중요한 정보가 포함되어 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-197">Access or collect all email messages the attacker accessed by using the internet-message-id to find them and then checking to see if any of those messages contains sensitive information.</span></span>

     - <span data-ttu-id="730f3-198">인터넷 메시지 ID를 사용하여 잠재적으로 중요한 전자 메일 메시지 집합과 관련된 감사 레코드를 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-198">Use the internet-message-id to search audit records related to a set of potentially sensitive email messages.</span></span> <span data-ttu-id="730f3-199">이 방법은 적은 수의 메시지만 우려하는 경우에 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-199">This is useful if you're concerned only about a small number of messages.</span></span>

## <a name="filtering-of-duplicate-audit-records"></a><span data-ttu-id="730f3-200">중복된 감사 레코드 필터링</span><span class="sxs-lookup"><span data-stu-id="730f3-200">Filtering of duplicate audit records</span></span>

<span data-ttu-id="730f3-201">한 시간 이내에 서로 발생하는 동일한 바인딩 작업에 대한 중복 감사 레코드는 감사 노이즈를 제거하기 위해 필터링됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-201">Duplicate audit records for the same bind operations that occur within an hour of each other are filtered out to remove auditing noise.</span></span> <span data-ttu-id="730f3-202">동기화 작업은 1시간 간격으로도 필터링됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-202">Sync operations are also filtered out at one-hour intervals.</span></span> <span data-ttu-id="730f3-203">이 중복 제거 프로세스의 예외는 동일한 인터넷 메시지 ID에 대해 다음의 표에 설명된 속성이 다른 경우 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-203">The exception to this de-duplication process occurs if, for the same internet-message-id, any of the properties described in the following table are different.</span></span> <span data-ttu-id="730f3-204">이러한 속성 중 하나가 중복 작업에서 다르면 새 감사 레코드가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-204">If one of these properties is different in a duplicate operation, a new audit record is generated.</span></span> <span data-ttu-id="730f3-205">이 프로세스는 다음 섹션에서 자세히 설명되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-205">This process is described in more detail in the next section.</span></span>

| <span data-ttu-id="730f3-206">속성</span><span class="sxs-lookup"><span data-stu-id="730f3-206">Property</span></span>| <span data-ttu-id="730f3-207">설명</span><span class="sxs-lookup"><span data-stu-id="730f3-207">Description</span></span>|
|:--------|:---------|
|<span data-ttu-id="730f3-208">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="730f3-208">ClientIPAddress</span></span> | <span data-ttu-id="730f3-209">클라이언트 컴퓨터의 IP 주소입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-209">IP address of the client computer.</span></span>|
|<span data-ttu-id="730f3-210">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="730f3-210">ClientInfoString</span></span>| <span data-ttu-id="730f3-211">클라이언트가 사서함에 액세스하는 데 사용한 클라이언트 프로토콜.</span><span class="sxs-lookup"><span data-stu-id="730f3-211">The client protocol, client used to access the mailbox.</span></span>| 
|<span data-ttu-id="730f3-212">ParentFolder</span><span class="sxs-lookup"><span data-stu-id="730f3-212">ParentFolder</span></span>    | <span data-ttu-id="730f3-213">액세스한 메일 항목의 전체 폴더 경로입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-213">The full folder path of the mail item that was accessed.</span></span> |
|<span data-ttu-id="730f3-214">Logon_type</span><span class="sxs-lookup"><span data-stu-id="730f3-214">Logon_type</span></span>      | <span data-ttu-id="730f3-215">작업을 수행한 사용자의 로그온 유형입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-215">The logon type of the user who performed the action.</span></span> <span data-ttu-id="730f3-216">로그온 유형 및 해당 열거형 값은 소유자(0), 관리자(1) 또는 대리자(2)입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-216">The logon types (and their corresponding Enum value) are Owner (0), Admin (1), or Delegate (2).</span></span>|
|<span data-ttu-id="730f3-217">MailAccessType</span><span class="sxs-lookup"><span data-stu-id="730f3-217">MailAccessType</span></span>  | <span data-ttu-id="730f3-218">액세스가 바인딩 혹은 동기화 작업인지의 여부입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-218">Whether the access is a bind or a sync operation.</span></span>|
|<span data-ttu-id="730f3-219">MailboxUPN</span><span class="sxs-lookup"><span data-stu-id="730f3-219">MailboxUPN</span></span>      | <span data-ttu-id="730f3-220">읽은 메시지가 있는 사서함의 UPN입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-220">The UPN of the mailbox where the message being read is located.</span></span>|
|<span data-ttu-id="730f3-221">사용자</span><span class="sxs-lookup"><span data-stu-id="730f3-221">User</span></span>            | <span data-ttu-id="730f3-222">메시지를 읽는 사용자의 UPN입니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-222">The UPN of the user reading the message.</span></span>|
|<span data-ttu-id="730f3-223">SessionId</span><span class="sxs-lookup"><span data-stu-id="730f3-223">SessionId</span></span>       | <span data-ttu-id="730f3-224">세션 ID는 공격자 작업과 일상적 사용자 활동을 같은 사서함에서 구별하는 데 도움이 됩니다(계정이 손상된 경우). 세션에 대한 자세한 내용은 [Exchange Online의 세션 내에서 공격자 활동 문맥화](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="730f3-224">The Session Id helps to differentiate attacker actions and day-to-day user activities in the same mailbox (in the case of account compromise) For more information about sessions, see [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span></span>|
||||

## <a name="identifying-the-access-contexts-of-different-audit-records"></a><span data-ttu-id="730f3-225">여러 감사 레코드의 액세스 컨텍스트 식별</span><span class="sxs-lookup"><span data-stu-id="730f3-225">Identifying the access contexts of different audit records</span></span>

<span data-ttu-id="730f3-226">일반적으로 공격자는 사서함 소유자가 사서함에 액세스하는 동시에 사서함에 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-226">It's common that an attacker may access a mailbox at the same time the mailbox owner is accessing it.</span></span> <span data-ttu-id="730f3-227">공격자와 사서함 소유자가 액세스하는 것을 구별하기 위해 액세스의 컨텍스트를 정의하는 감사 레코드 속성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-227">To differentiate between access by the attacker and the mailbox owner, there are audit record properties that define the context of the access.</span></span> <span data-ttu-id="730f3-228">앞서 설명한 것처럼 이러한 속성의 값이 다를 경우 심지어 해당 작업이 집계 간격 내에 발생할 때도 별도의 감사 레코드가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-228">As previously explained, when the values for these properties are different, even when the activity occurs within the aggregation interval, separate audit records are generated.</span></span> <span data-ttu-id="730f3-229">다음의 예제에는 세 가지의 다양한 감사 레코드가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-229">In the following example, there are three different audit records.</span></span> <span data-ttu-id="730f3-230">각 감사 레코드는 세션 ID와 ClientIPAddress 속성으로 구분됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-230">Each one is differentiated by the Session Id and ClientIPAddress properties.</span></span> <span data-ttu-id="730f3-231">액세스한 메시지도 식별됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-231">The messages that were accessed are also identified.</span></span>

|<span data-ttu-id="730f3-232">감사 레코드 1</span><span class="sxs-lookup"><span data-stu-id="730f3-232">Audit record 1</span></span>  |<span data-ttu-id="730f3-233">감사 레코드 2</span><span class="sxs-lookup"><span data-stu-id="730f3-233">Audit record 2</span></span>  |<span data-ttu-id="730f3-234">감사 레코드 3</span><span class="sxs-lookup"><span data-stu-id="730f3-234">Audit record 3</span></span>|
|---------|---------|---------|
|<span data-ttu-id="730f3-235">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="730f3-235">ClientIPAddress**1**</span></span><br/><span data-ttu-id="730f3-236">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="730f3-236">SessionId**2**</span></span>|<span data-ttu-id="730f3-237">ClientIPAddress**2**</span><span class="sxs-lookup"><span data-stu-id="730f3-237">ClientIPAddress**2**</span></span><br/><span data-ttu-id="730f3-238">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="730f3-238">SessionId**2**</span></span>|<span data-ttu-id="730f3-239">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="730f3-239">ClientIPAddress**1**</span></span><br/><span data-ttu-id="730f3-240">SessionId**3**</span><span class="sxs-lookup"><span data-stu-id="730f3-240">SessionId**3**</span></span>|
|<span data-ttu-id="730f3-241">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="730f3-241">InternetMessageId**A**</span></span><br/><span data-ttu-id="730f3-242">InternetMessageId**D**</span><span class="sxs-lookup"><span data-stu-id="730f3-242">InternetMessageId**D**</span></span><br/><span data-ttu-id="730f3-243">InternetMessageId**E**</span><span class="sxs-lookup"><span data-stu-id="730f3-243">InternetMessageId**E**</span></span><br/><span data-ttu-id="730f3-244">InternetMessageId**F**</span><span class="sxs-lookup"><span data-stu-id="730f3-244">InternetMessageId**F**</span></span><br/>|<span data-ttu-id="730f3-245">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="730f3-245">InternetMessageId**A**</span></span><br/><span data-ttu-id="730f3-246">InternetMessageId**C**</span><span class="sxs-lookup"><span data-stu-id="730f3-246">InternetMessageId**C**</span></span>|<span data-ttu-id="730f3-247">InternetMessageId**B**</span><span class="sxs-lookup"><span data-stu-id="730f3-247">InternetMessageId**B**</span></span> |
||||

<span data-ttu-id="730f3-248">[이전 섹션](#filtering-of-duplicate-audit-records)의 테이블에 나열된 속성 중 하나라도 다르면 새 컨텍스트를 추적하는 별도의 감사 레코드가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-248">If any of the properties listed in the table in the [previous section](#filtering-of-duplicate-audit-records) are different, a separate audit record is generated to track the new context.</span></span> <span data-ttu-id="730f3-249">액세스는 활동이 발생한 컨텍스트에 따라 별도의 감사 레코드로 정렬됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-249">Accesses will be sorted into the separate audit records depending on the context in which the activity took place.</span></span>

<span data-ttu-id="730f3-250">예를 들어, 다음의 스크린샷에 표시된 감사 레코드에서 EWSEditor와 OWA에서 동시에 메일에 액세스를 하지만, 액세스 활동은 액세스가 발생한 컨텍스트에 따라 다른 감사 레코드로 정렬됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-250">For example, in audit records shown in the following screenshot, though we are accessing mail from EWSEditor and OWA simultaneously, the access activity is collated in different audit records depending on the context in which the access took place.</span></span> <span data-ttu-id="730f3-251">이 경우 컨텍스트는 ClientInfoString 속성에 대 한 다양한 값으로 정의됩니다.</span><span class="sxs-lookup"><span data-stu-id="730f3-251">In this case, the context is defined by different values for the ClientInfoString property.</span></span>

![컨텍스트에 기반한 다양한 감사 레코드](../media/MailItemsAccessed4.png)
